<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>الهوية</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="/public/app.css" rel="stylesheet">
<link href="/public/moe-ui.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
  <%- include('partials_nav', {user:user}) %>

  <% if (flash) { %>
    <div class="alert alert-<%= flash.type %>"><%= flash.msg %></div>
  <% } %>

  <div class="row g-3">
    <div class="col-12 col-lg-6">
      <div class="card p-4">
        <h4 class="fw-bold mb-3">بيانات الجهة</h4>
        <form method="post" action="/admin/branding/update" class="row g-2">
          <div class="col-12">
            <label class="form-label">اسم الجهة (عربي)</label>
            <input class="form-control" name="org_name_ar" value="<%= branding.org_name_ar || '' %>">
          </div>
          <div class="col-12">
            <label class="form-label">اسم الجهة (English)</label>
            <input class="form-control" name="org_name_en" value="<%= branding.org_name_en || '' %>">
          </div>
          <div class="col-12">
            <label class="form-label">اسم الوحدة/المكتب (عربي)</label>
            <input class="form-control" name="org_unit_ar" value="<%= branding.org_unit_ar || '' %>">
          </div>
          <div class="col-12">
            <label class="form-label">اسم الوحدة/المكتب (English)</label>
            <input class="form-control" name="org_unit_en" value="<%= branding.org_unit_en || '' %>">
          </div>
          <div class="col-12">
            <label class="form-label">الموقع (عربي)</label>
            <input class="form-control" name="location_ar" value="<%= branding.location_ar || '' %>">
          </div>
          <div class="col-12">
            <label class="form-label">الموقع (English)</label>
            <input class="form-control" name="location_en" value="<%= branding.location_en || '' %>">
          </div>

          <hr class="my-2"/>

          <div class="col-12">
            <h5 class="fw-bold mb-2">التقييم</h5>
            <div class="text-muted small">حالة وضع التقييم (تم نقله إلى صفحة الإعدادات).</div>
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mt-2 p-3 rounded border bg-body-tertiary">
              <div>
                <div class="fw-bold">
                  الوضع الحالي:
                  <span class="badge <%= (feedback_mode||'shared')==='per_counter' ? 'text-bg-primary' : 'text-bg-success' %>">
                    <%= (feedback_mode||'shared')==='per_counter' ? 'لكل كونتر' : 'مشترك' %>
                  </span>
                </div>
                <div class="small text-muted mt-1">
                  <%= (feedback_mode||'shared')==='per_counter' ? 'استخدم رابط التقييم مع رقم الكونتر مثل: /feedback?counter_id=1' : 'جهاز واحد عند المخرج (طابور تقييم).' %>
                </div>
              </div>
              <a class="btn btn-outline-secondary" href="/admin#feedbackSettings">تعديل من الإعدادات</a>
            </div>
          </div>

          <hr class="my-2"/>

          <div class="col-12">
            <h5 class="fw-bold mb-2">اعتماد التقارير</h5>
            <div class="text-muted small">تظهر هذه البيانات في أسفل تقارير PDF عند الطباعة.</div>
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">المشرف</label>
            <input class="form-control" name="supervisor" value="<%= (report_meta && report_meta.supervisor) ? report_meta.supervisor : '' %>">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">المُعدّ</label>
            <input class="form-control" name="prepared_by" value="<%= (report_meta && report_meta.prepared_by) ? report_meta.prepared_by : '' %>">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">المراجع</label>
            <input class="form-control" name="reviewed_by" value="<%= (report_meta && report_meta.reviewed_by) ? report_meta.reviewed_by : '' %>">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">المعتمد</label>
            <input class="form-control" name="approved_by" value="<%= (report_meta && report_meta.approved_by) ? report_meta.approved_by : '' %>">
          </div>
          <div class="col-12 col-md-6">
            <label class="form-label">إصدار التقرير</label>
            <input class="form-control" name="report_version" value="<%= (report_meta && report_meta.report_version) ? report_meta.report_version : '' %>" placeholder="مثال: v1.0">
          </div>
          <div class="col-12">
            <button class="btn btn-primary w-100">حفظ</button>
          </div>
        </form>
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card p-4">
        <h4 class="fw-bold mb-3">الشعار</h4>
        <div class="d-flex align-items-center gap-3 flex-wrap">
          <div style="width:120px;height:120px;border-radius:24px;overflow:hidden;border:1px solid rgba(0,0,0,.08);background:#fff;display:flex;align-items:center;justify-content:center;">
            <% if (branding.logo_path) { %>
              <img alt="logo" src="<%= branding.logo_path %>?v=<%= Date.now() %>" style="max-width:100%;max-height:100%;object-fit:contain;">
            <% } else { %>
              <div class="moe-badge">MOE</div>
            <% } %>
          </div>
          <div class="muted">
            <div>يرجى رفع شعار PNG/SVG/JPG (يفضل خلفية شفافة).</div>
            <div class="small">سيظهر في الكشك، شاشة الأرقام، شاشة الموظف، والتقييم.</div>
          </div>
        </div>
        <hr/>
        <form method="post" action="/admin/branding/logo" enctype="multipart/form-data" class="row g-2">
          <div class="col-12">
            <input class="form-control" type="file" name="logo_file" accept="image/*" required>
          </div>
          <div class="col-12">
            <button class="btn btn-outline-secondary w-100">رفع الشعار</button>
          </div>
        </form>
      </div>

      <div class="card p-4 mt-3">
        <h4 class="fw-bold mb-2">ملاحظة تشغيل مهمة</h4>
        <div class="muted">لتحقيق تجربة "بلا نوافذ طباعة" شغّل جهاز الكشك بمتصفح Chrome مع وضع Kiosk (مثل: --kiosk --kiosk-printing) وحدد طابعة افتراضية في النظام.</div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
