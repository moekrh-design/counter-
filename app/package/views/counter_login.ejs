<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>دخول الموظف</title>

<!-- Keep system look: Bootstrap RTL (same approach as admin login) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<link href="/public/app.css" rel="stylesheet">
<link href="/public/moe-ui.css" rel="stylesheet">
<script src="/public/app.js"></script>
</head>

<body class="d-flex align-items-center" style="min-height:100vh">
  <div class="container py-5" style="max-width:520px">
    <div class="card p-4">
      <h3 class="fw-bold mb-1">دخول موظف الكاونتر</h3>
      <div class="text-muted mb-3">سجّل دخولك وسيتم إسناد كونتر تلقائيًا</div>

      <div id="closedAlert" class="alert alert-success" style="display:<%= closed ? 'block' : 'none' %>">
        تم إغلاق الكونتر بنجاح ✅
      </div>

      <% if (error) { %>
        <div class="alert alert-danger"><%= error %></div>
      <% } %>

      <form method="post" action="/counter/login" autocomplete="off">
        <!-- Autofill buster (some browsers ignore autocomplete=off) -->
        <input type="text" name="fake_username" style="display:none" autocomplete="username">
        <input type="password" name="fake_password" style="display:none" autocomplete="current-password">

        <div class="mb-3">
          <label class="form-label">اسم المستخدم</label>
        <input class="form-control" name="username" id="username"
                 required autocapitalize="off" spellcheck="false"
                 autocomplete="username" inputmode="text"
                 readonly>
        </div>

        <div class="mb-3">
          <label class="form-label">كلمة المرور</label>
          <input class="form-control" type="password" name="password" id="password"
                 required autocomplete="current-password" readonly>
        </div>

        <button class="btn btn-primary w-100">دخول</button>
      </form>
    </div>
  </div>

  <script>
    (function(){
      // Autofill + BFCache resistant clearing:
      // 1) keep inputs readonly briefly so the browser can't auto-fill
      // 2) clear values after paint
      // 3) remove readonly so the user can type
      function unlock(){
        var u = document.getElementById('username');
        var p = document.getElementById('password');
        if (u) u.removeAttribute('readonly');
        if (p) p.removeAttribute('readonly');
      }
      function hardClear(){
        var u = document.getElementById('username');
        var p = document.getElementById('password');
        if (u) u.value = '';
        if (p) p.value = '';
      }
      try{
        hardClear();
        setTimeout(hardClear, 50);
        setTimeout(unlock, 120);
        // If browser restores from back/forward cache, clear again
        window.addEventListener('pageshow', function(){
          hardClear();
          setTimeout(hardClear, 50);
        });
      }catch(e){}

      // Show closed alert if URL says so (extra safety)
      try{
        var params = new URLSearchParams(window.location.search);
        if (params.get('closed') === '1'){
          var a = document.getElementById('closedAlert');
          if (a) a.style.display = 'block';
        }
      }catch(e){}
    })();
  </script>
</body>
</html>
