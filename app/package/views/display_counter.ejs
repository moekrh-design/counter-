<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>شاشة كونتر <%= counter.id %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/public/app.css" rel="stylesheet">
  <link href="/public/moe-ui.css" rel="stylesheet">
  <script src="/public/app.js"></script>
</head>
<body class="display-body">
  <div class="display-shell">
    <header class="display-header">
      <div class="d-flex align-items-center gap-3">
        <% if (branding && branding.logo_path) { %>
          <div class="kiosk-brand-logo" style="width:56px;height:56px"><img alt="logo" src="<%= branding.logo_path %>" class="kiosk-logo-img"/></div>
        <% } else { %>
          <div class="moe-badge">MOE</div>
        <% } %>
        <div>
          <div class="display-title"><%= (branding && branding.org_name_ar) ? branding.org_name_ar : 'وزارة التعليم' %></div>
          <div class="display-subtitle"><%= (branding && branding.org_unit_ar) ? branding.org_unit_ar : 'مكتب رعاية المستفيدين' %></div>
        </div>
      </div>
      <div class="text-center">
        <div class="muted">كونتر</div>
        <div class="display-ticket" style="font-size: 64px; line-height: 1; margin:0"><%= counter.id %></div>
      </div>
    </header>

    <main class="display-main">
      <div class="display-card" style="min-height: calc(100vh - 170px); display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="muted" style="font-size: 1.35rem">الرقم الحالي</div>
        <div id="ticket" class="display-ticket" style="font-size: 120px;">—</div>
        <div id="state" class="muted mt-2" style="font-size: 1.6rem">بانتظار</div>
      </div>
    </main>
  </div>

  <script>
    const counterId = <%= counter.id %>;
    async function refresh(){
      const res = await fetch(`/api/display/counter/${counterId}`);
      const data = await res.json();
      if(!data.ok) return;
      const t = document.getElementById('ticket');
      const s = document.getElementById('state');
      if(!data.current){
        t.textContent = '—';
        s.textContent = 'بانتظار';
        return;
      }
      t.textContent = data.current.ticket_code;
      s.textContent = (data.current.state === 'IN_SERVICE') ? 'قيد الخدمة' : 'يُرجى التوجه';
    }
    setInterval(refresh, 800);
    refresh();
  </script>
</body>
</html>
